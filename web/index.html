<!DOCTYPE html>
<html>

<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Sistem Informasi Manajemen Aset BRIDA">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="SIM-ASET">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png" />
  <title>SIM-ASET BRIDA</title>
  <link rel="manifest" href="manifest.json">

  <!-- CRITICAL: Firebase SDK HARUS di-load SEBELUM flutter_bootstrap.js -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
</head>

<body>
  <!-- Firebase Configuration HARUS sebelum flutter_bootstrap.js -->
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDRssnH1E1QOdbfRJtLXO8dcyo6ktsGhmQ",
      authDomain: "clean-office-app.firebaseapp.com",
      projectId: "clean-office-app",
      storageBucket: "clean-office-app.firebasestorage.app",
      messagingSenderId: "112282417853",
      appId: "1:112282417853:web:4c2b46e4c94fbe7bd355d4",
      measurementId: "G-4KF0L88D97"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Debug log
    console.log("✅ Firebase initialized successfully");

    // ========== BROWSER NOTIFICATION HELPERS ==========

    // Check if notifications are supported
    window.isNotificationSupported = function () {
      return 'Notification' in window;
    };

    // Get current notification permission status
    window.getNotificationPermission = function () {
      if (!('Notification' in window)) return 'unsupported';
      return Notification.permission; // 'granted', 'denied', or 'default'
    };

    // Request notification permission
    window.requestNotificationPermission = async function () {
      if (!('Notification' in window)) {
        return 'unsupported';
      }
      try {
        const permission = await Notification.requestPermission();
        console.log('Notification permission:', permission);
        return permission;
      } catch (e) {
        console.error('Error requesting notification permission:', e);
        return 'error';
      }
    };

    // Show a notification
    window.showBrowserNotification = function (title, body, icon) {
      if (Notification.permission !== 'granted') {
        console.warn('Notification permission not granted');
        return false;
      }
      try {
        const notification = new Notification(title, {
          body: body,
          icon: icon || '/icons/Icon-192.png',
          badge: '/icons/Icon-192.png',
          tag: 'sim-aset-notification',
          requireInteraction: false,
        });
        notification.onclick = function () {
          window.focus();
          notification.close();
        };
        return true;
      } catch (e) {
        console.error('Error showing notification:', e);
        return false;
      }
    };

    // ========== NOTIFICATION SOUND ==========

    // Play notification sound using Web Audio API
    window.playNotificationSound = function () {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        const playTone = (frequency, startTime, duration) => {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = 'sine';

          gainNode.gain.setValueAtTime(0, startTime);
          gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
          gainNode.gain.linearRampToValueAtTime(0.1, startTime + duration * 0.5);
          gainNode.gain.linearRampToValueAtTime(0, startTime + duration);

          oscillator.start(startTime);
          oscillator.stop(startTime + duration);
        };

        const now = audioContext.currentTime;
        playTone(880, now, 0.15);
        playTone(1108.73, now + 0.15, 0.2);

        return true;
      } catch (e) {
        console.error('Error playing notification sound:', e);
        return false;
      }
    };

    console.log("✅ Notification helpers initialized");
  </script>

  <!-- Flutter Bootstrap - HARUS TERAKHIR -->
  <script src="flutter_bootstrap.js" async></script>
</body>

</html>